// C++ program to find groups of unknown
// Points using K nearest neighbour algorithm.
#include <stdio.h>
#include <stdlib.h>
#include <math.h>

typedef struct _Point
{
     int distance; // Distance from test point
     int x, y, z, k, w;     // Co-ordinate of point
     int val;     // Group of point
} Point;
    static int class[12] ;

/***
//results
 Classified as 1
 Classified as 1
 Classified as 1
 Classified as 1
 Classified as 0
 Classified as 0
 Classified as 0
 Classified as 2
 Classified as 2
 Classified as 2
 Classified as 2
 Classified as 2
*/

volatile int __attribute__((section(".mySection_par"))) startPar =  0x00 ;
volatile int __attribute__((section(".mySection_par_num"))) par_num =  0x03 ; //constant
volatile int __attribute__((section(".mySection_arr_str"))) arr_str =  0x00 ;
volatile int __attribute__((section(".mySection_arr_end"))) arr_end =  0x00 ;
int comparison(const void* a, const void* b)
{
    const Point* p1 = a;
     const Point* p2 = b;
    return (p1->distance - p2->distance);
}

// This function finds classification of point p using
// k nearest neighbour algorithm. It assumes only two
// groups and returns 0 if p belongs to group 0, else
// 1 (belongs to group 1).
int classifyAPoint(Point* arr, int n, int k, Point p)
{
    // Fill distances of all points from p
		startPar = 0x1;
    for ( int i = 0; i < n; i++){
        arr[i].distance =
            (arr[i].x - p.x) * (arr[i].x - p.x) +
                 (arr[i].z - p.z) * (arr[i].z - p.z) + //sqrt
                 (arr[i].k - p.k) * (arr[i].k - p.k) +
                 (arr[i].y - p.y) * (arr[i].y - p.y)+
                 (arr[i].w - p.w) * (arr[i].w - p.w);

                 //printf(" %d ", arr[i].distance);
    }
	startPar = 0x0;

    // Sort the Points by distance from p
    qsort(arr, n, sizeof(Point), &comparison);
    //   printf("\n as \n");

   //  for (int i = 0; i < n; i++){
     //  printf("%d ", arr[i].distance);
     //  printf(": %d / ", arr[i].x);


   // }
           // printf("\n");

    // Now consider the first k elements and only
    // 3 groups
     int freq1 = 0;     // Frequency of group 0
     int freq2 = 0;     // Frequency of group 1
     int freq3 = 0;     // Frequency of group 3
    for (int i = 0; i < k; i++)
    {
        if (arr[i].val == 0)
            freq1++;
        else if (arr[i].val == 1)
            freq2++;
	else if (arr[i].val == 2)
            freq3++;
    }
	//	return 1;

	if (freq1 >= freq3 && freq1 >= freq2)
		return 0;
	if (freq2 >= freq1 && freq2 >= freq3)
		return 1;
	if (freq3 >= freq2 && freq3 >= freq1)
		return 2;
}


static   Point arr [150] = {{0,0x51,0x51,0x38,0x16,0x03,1},
							{0,0x4E,0x4E,0x30,0x16,0x03,1},
							{0,0x4B,0x4B,0x33,0x14,0x03,1},
							{0,0x49,0x49,0x31,0x18,0x03,1},
							{0,0x50,0x50,0x39,0x16,0x03,1},
							{0,0x56,0x56,0x3E,0x1B,0x06,1},
							{0,0x49,0x49,0x36,0x16,0x04,1},
							{0,0x50,0x50,0x36,0x18,0x03,1},
							{0,0x46,0x46,0x2E,0x16,0x03,1},
							{0,0x4E,0x4E,0x31,0x18,0x01,1},
							{0,0x56,0x56,0x3B,0x18,0x03,1},
							{0,0x04,0x04,0x36,0x19,0x03,1},
							{0,0x04,0x04,0x30,0x16,0x01,1},
							{0,0x44,0x44,0x30,0x11,0x01,1},
							{0,0x5C,0x5C,0x40,0x13,0x03,1},
							{0,0x5B,0x5B,0x46,0x18,0x06,1},
							{0,0x56,0x56,0x3E,0x14,0x06,1},
							{0,0x51,0x51,0x38,0x16,0x04,1},
							{0,0x5B,0x5B,0x3C,0x1B,0x04,1},
							{0,0x51,0x51,0x3C,0x18,0x04,1},
							{0,0x56,0x56,0x36,0x1B,0x03,1},
							{0,0x51,0x51,0x3B,0x18,0x06,1},
							{0,0x49,0x49,0x39,0x10,0x03,1},
							{0,0x51,0x51,0x34,0x1B,0x08,1},
							{0,0x04,0x04,0x36,0x1E,0x03,1},
							{0,0x50,0x50,0x30,0x19,0x03,1},
							{0,0x50,0x50,0x36,0x19,0x06,1},
							{0,0x53,0x53,0x38,0x18,0x03,1},
							{0,0x53,0x53,0x36,0x16,0x03,1},
							{0,0x4B,0x4B,0x33,0x19,0x03,1},
							{0,0x04,0x04,0x31,0x19,0x03,1},
							{0,0x56,0x56,0x36,0x18,0x06,1},
							{0,0x53,0x53,0x41,0x18,0x01,1},
							{0,0x58,0x58,0x43,0x16,0x03,1},
							{0,0x4E,0x4E,0x31,0x18,0x01,1},
							{0,0x50,0x50,0x33,0x13,0x03,1},
							{0,0x58,0x58,0x38,0x14,0x03,1},
							{0,0x4E,0x4E,0x31,0x18,0x01,1},
							{0,0x46,0x46,0x30,0x14,0x03,1},
							{0,0x51,0x51,0x36,0x18,0x03,1},
							{0,0x50,0x50,0x38,0x14,0x04,1},
							{0,0x48,0x48,0x24,0x14,0x04,1},
							{0,0x46,0x46,0x33,0x14,0x03,1},
							{0,0x50,0x50,0x38,0x19,0x09,1},
							{0,0x51,0x51,0x3C,0x1E,0x06,1},
							{0,0x04,0x04,0x30,0x16,0x04,1},
							{0,0x51,0x51,0x3C,0x19,0x03,1},
							{0,0x49,0x49,0x33,0x16,0x03,1},
							{0,0x54,0x54,0x3B,0x18,0x03,1},
							{0,0x50,0x50,0x34,0x16,0x03,1},
							{0,0x70,0x70,0x33,0x4B,0x16,0},
							{0,0x66,0x66,0x33,0x48,0x18,0},
							{0,0x6E,0x6E,0x31,0x4E,0x18,0},
							{0,0x58,0x58,0x24,0x40,0x14,0},
							{0,0x68,0x68,0x2C,0x49,0x18,0},
							{0,0x5B,0x5B,0x2C,0x48,0x14,0},
							{0,0x64,0x64,0x34,0x4B,0x19,0},
							{0,0x4E,0x4E,0x26,0x34,0x10,0},
							{0,0x69,0x69,0x2E,0x49,0x14,0},
							{0,0x53,0x53,0x2B,0x3E,0x16,0},
							{0,0x50,0x50,0x20,0x38,0x10,0},
							{0,0x5E,0x5E,0x30,0x43,0x18,0},
							{0,0x60,0x60,0x23,0x40,0x10,0},
							{0,0x61,0x61,0x2E,0x4B,0x16,0},
							{0,0x59,0x59,0x2E,0x39,0x14,0},
							{0,0x6B,0x6B,0x31,0x46,0x16,0},
							{0,0x59,0x59,0x30,0x48,0x18,0},
							{0,0x5C,0x5C,0x2B,0x41,0x10,0},
							{0,0x63,0x63,0x23,0x48,0x18,0},
							{0,0x59,0x59,0x28,0x3E,0x11,0},
							{0,0x5E,0x5E,0x33,0x04,0x1C,0},
							{0,0x61,0x61,0x2C,0x40,0x14,0},
							{0,0x64,0x64,0x28,0x4E,0x18,0},
							{0,0x61,0x61,0x2C,0x4B,0x13,0},
							{0,0x66,0x66,0x2E,0x44,0x14,0},
							{0,0x69,0x69,0x30,0x46,0x16,0},
							{0,0x6C,0x6C,0x2C,0x04,0x16,0},
							{0,0x6B,0x6B,0x30,0x50,0x1B,0},
							{0,0x60,0x60,0x2E,0x48,0x18,0},
							{0,0x5B,0x5B,0x29,0x38,0x10,0},
							{0,0x58,0x58,0x26,0x3C,0x11,0},
							{0,0x58,0x58,0x26,0x3B,0x10,0},
							{0,0x5C,0x5C,0x2B,0x3E,0x13,0},
							{0,0x60,0x60,0x2B,0x51,0x19,0},
							{0,0x56,0x56,0x30,0x48,0x18,0},
							{0,0x60,0x60,0x36,0x48,0x19,0},
							{0,0x6B,0x6B,0x31,0x4B,0x18,0},
							{0,0x64,0x64,0x24,0x46,0x14,0},
							{0,0x59,0x59,0x30,0x41,0x14,0},
							{0,0x58,0x58,0x28,0x40,0x14,0},
							{0,0x58,0x58,0x29,0x46,0x13,0},
							{0,0x61,0x61,0x30,0x49,0x16,0},
							{0,0x5C,0x5C,0x29,0x40,0x13,0},
							{0,0x50,0x50,0x24,0x34,0x10,0},
							{0,0x59,0x59,0x2B,0x43,0x14,0},
							{0,0x5B,0x5B,0x30,0x43,0x13,0},
							{0,0x5B,0x5B,0x2E,0x43,0x14,0},
							{0,0x63,0x63,0x2E,0x44,0x14,0},
							{0,0x51,0x51,0x28,0x30,0x11,0},
							{0,0x5B,0x5B,0x2C,0x41,0x14,0},
							{0,0x64,0x64,0x34,0x60,0x28,2},
							{0,0x5C,0x5C,0x2B,0x51,0x1E,2},
							{0,0x71,0x71,0x30,0x5E,0x21,2},
							{0,0x64,0x64,0x2E,0x59,0x1C,2},
							{0,0x68,0x68,0x30,0x5C,0x23,2},
							{0,0x79,0x79,0x30,0x69,0x21,2},
							{0,0x4E,0x4E,0x28,0x48,0x1B,2},
							{0,0x74,0x74,0x2E,0x64,0x1C,2},
							{0,0x6B,0x6B,0x28,0x5C,0x1C,2},
							{0,0x73,0x73,0x39,0x61,0x28,2},
							{0,0x68,0x68,0x33,0x51,0x20,2},
							{0,0x66,0x66,0x2B,0x54,0x1E,2},
							{0,0x6C,0x6C,0x30,0x58,0x21,2},
							{0,0x5B,0x5B,0x28,0x50,0x20,2},
							{0,0x5C,0x5C,0x2C,0x51,0x26,2},
							{0,0x66,0x66,0x33,0x54,0x24,2},
							{0,0x68,0x68,0x30,0x58,0x1C,2},
							{0,0x7B,0x7B,0x3C,0x6B,0x23,2},
							{0,0x7B,0x7B,0x29,0x6E,0x24,2},
							{0,0x60,0x60,0x23,0x50,0x18,2},
							{0,0x6E,0x6E,0x33,0x5B,0x24,2},
							{0,0x59,0x59,0x2C,0x4E,0x20,2},
							{0,0x7B,0x7B,0x2C,0x6B,0x20,2},
							{0,0x64,0x64,0x2B,0x4E,0x1C,2},
							{0,0x6B,0x6B,0x34,0x5B,0x21,2},
							{0,0x73,0x73,0x33,0x60,0x1C,2},
							{0,0x63,0x63,0x2C,0x04,0x1C,2},
							{0,0x61,0x61,0x30,0x4E,0x1C,2},
							{0,0x66,0x66,0x2C,0x59,0x21,2},
							{0,0x73,0x73,0x30,0x5C,0x19,2},
							{0,0x76,0x76,0x2C,0x61,0x1E,2},
							{0,0x7E,0x7E,0x3C,0x66,0x20,2},
							{0,0x66,0x66,0x2C,0x59,0x23,2},
							{0,0x64,0x64,0x2C,0x51,0x18,2},
							{0,0x61,0x61,0x29,0x59,0x16,2},
							{0,0x7B,0x7B,0x30,0x61,0x24,2},
							{0,0x64,0x64,0x36,0x59,0x26,2},
							{0,0x66,0x66,0x31,0x58,0x1C,2},
							{0,0x60,0x60,0x30,0x04,0x1C,2},
							{0,0x6E,0x6E,0x31,0x56,0x21,2},
							{0,0x6B,0x6B,0x31,0x59,0x26,2},
							{0,0x6E,0x6E,0x31,0x51,0x24,2},
							{0,0x5C,0x5C,0x2B,0x51,0x1E,2},
							{0,0x6C,0x6C,0x33,0x5E,0x24,2},
							{0,0x6B,0x6B,0x34,0x5B,0x28,2},
							{0,0x6B,0x6B,0x30,0x53,0x24,2},
							{0,0x64,0x64,0x28,0x50,0x1E,2},
							{0,0x68,0x68,0x30,0x53,0x20,2},
							{0,0x63,0x63,0x36,0x56,0x24,2},
							{0,0x5E,0x5E,0x30,0x51,0x1C,2} };
		
		
 int* knn(){

   /***
//changeable variables */
//#define print_en
//arr = 0x200;

//test = 0x100;

arr_str =  &arr[0] ;
arr_end =  &arr[149] + (&arr[149] -&arr[148]  ) ;

static  Point test [12] = { {0,0x44,0x44,0x2E,0x1B,0x04,0},
							{0,0x49,0x49,0x2B,0x18,0x03,0},
							{0,0x54,0x54,0x36,0x19,0x03,0},
							{0,0x53,0x53,0x41,0x18,0x01,0},
							{0,0x60,0x60,0x23,0x43,0x10,0},
							{0,0x63,0x63,0x24,0x48,0x18,0},
							{0,0x50,0x50,0x21,0x39,0x13,0},
							{0,0x69,0x69,0x2C,0x56,0x20,0},
							{0,0x66,0x66,0x33,0x54,0x24,0},
							{0,0x70,0x70,0x31,0x58,0x1C,0},
							{0,0x63,0x63,0x34,0x5E,0x21,0},
							{0,0x69,0x69,0x2E,0x54,0x24,0}};

    int n = 150; // Number of data points

    /*Testing Point*/

    // Parameter to decide groupr of the testing point
     int k = 3;


/***
//non changable variables */
    //volatile int class[12] ;
    //int* class = ;
    for ( int z = 0; z < 1; z++){
		    class[z] = 1 ;
			class[z] = classifyAPoint(arr, n, k, test[z]) ;
			    #ifdef print_en
			printf(" Classified as %d\n", class[z]);
            #endif // print_en

	}


	return class;

}

// http://www.bytecraft.com/Fixed_Point_Converter

//int* a; a = 0x100;    256
//int* b; b = 0x200;	512

// Used to sort an array of points by increasing
// order of distance

// Driver code
int main()
{

volatile int* i;
i = knn();

    return 0;
}
